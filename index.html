<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DAL Answer Viewer</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0; padding:16px; line-height:1.45}
    a{word-break:break-word; text-decoration:underline}
    pre,code{white-space:pre-wrap; word-break:break-word}
    .wrap{max-width:900px; margin:0 auto}
  </style>
  <!-- Tiny, zero-config Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="wrap" id="out">Waiting for contentâ€¦</div>

  <script>
    // Harden marked a bit
    marked.setOptions({ mangle:false, headerIds:false });

    function render(md){
      // Remove control tags from the app
      md = (md || '')
        .replace(/<<START ANSWER>>/g,'')
        .replace(/<<END ANSWER>>/g,'')
        .replace(/\[COMPLETED\]/g,'')
        .trim();

      // Convert Markdown -> HTML
      const html = marked.parse(md);

      // Inject and fix links to open externally
      const out = document.getElementById('out');
      out.innerHTML = html;
      out.querySelectorAll('a').forEach(a=>{
        a.target = '_blank';
        a.rel = 'noopener';
      });
    }

    // Receive content from Thunkable Web Viewer
    window.addEventListener('message', (e)=>{
      try { render(e.data); } catch(err){ console.error(err); }
    }, false);

    // Optional: allow quick manual test by pasting content via hash
    if (location.hash && location.hash.length > 1){
      render(decodeURIComponent(location.hash.slice(1)));
    }
  </script>
</body>
</html>
